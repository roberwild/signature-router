<?xml version="1.0" encoding="UTF-8"?>
<story-context id="signature-router-1-1-context" version="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.1</storyId>
    <storyKey>1-1-project-bootstrap-hexagonal-structure</storyKey>
    <title>Project Bootstrap & Hexagonal Structure</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-11-26</generatedAt>
    <generator>BMAD Story Context Workflow v6</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-1-project-bootstrap-hexagonal-structure.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Developer</asA>
    <iWant>Un proyecto Spring Boot 3 con estructura hexagonal completa</iWant>
    <soThat>Puedo implementar features siguiendo DDD + Hexagonal Architecture sin violar separation of concerns</soThat>
    
    <context>
      Esta es la primera story del proyecto que establece la base técnica fundamental para el Sistema de Enrutamiento y Gestión de Firmas Digitales. 
      El proyecto debe soportar arquitectura hexagonal estricta donde el dominio permanece puro (sin dependencias de frameworks) y los adapters gestionan integraciones externas.
      Compliance Requirements: PCI-DSS, GDPR, SOC 2.
      Este story es bloqueante para Stories 1.2-1.8.
    </context>

    <tasks>
      <task id="1" ac="AC1">
        <title>Initialize Maven Project</title>
        <subtasks>
          <subtask id="1.1">Crear directorio raíz signature-router/</subtask>
          <subtask id="1.2">Ejecutar mvn archetype:generate con parámetros específicos</subtask>
          <subtask id="1.3">Configurar pom.xml con Spring Boot 3.2.0 parent y Java 21</subtask>
          <subtask id="1.4">Instalar Maven Wrapper</subtask>
          <subtask id="1.5">Crear .gitignore</subtask>
          <subtask id="1.6">Verificar compilación inicial</subtask>
        </subtasks>
      </task>
      
      <task id="2" ac="AC2">
        <title>Create Hexagonal Package Structure</title>
        <subtasks>
          <subtask id="2.1">Crear estructura de directorios completa (domain, application, infrastructure)</subtask>
          <subtask id="2.2">Crear placeholders .gitkeep en directorios vacíos</subtask>
          <subtask id="2.3">Mover Application.java a infrastructure/SignatureRouterApplication.java</subtask>
          <subtask id="2.4">Actualizar package declaration</subtask>
          <subtask id="2.5">Agregar @ComponentScan para escanear todos los paquetes</subtask>
        </subtasks>
      </task>
      
      <task id="3" ac="AC3,AC6">
        <title>Configure Spring Boot Application</title>
        <subtasks>
          <subtask id="3.1">Crear src/main/resources/application.yml</subtask>
          <subtask id="3.2">Crear application-local.yml (dev profile)</subtask>
          <subtask id="3.3">Crear application-test.yml (test profile)</subtask>
          <subtask id="3.4">Crear logback-spring.xml (opcional)</subtask>
          <subtask id="3.5">Verificar startup con mvn spring-boot:run</subtask>
          <subtask id="3.6">Confirmar log "Started SignatureRouterApplication"</subtask>
          <subtask id="3.7">Test manual: curl http://localhost:8080/actuator/health</subtask>
        </subtasks>
      </task>
      
      <task id="4" ac="AC5">
        <title>Add Essential Dependencies</title>
        <subtasks>
          <subtask id="4.1">Agregar dependencies a pom.xml (web, data-jpa, actuator, lombok, archunit)</subtask>
          <subtask id="4.2">Ejecutar mvn dependency:tree</subtask>
          <subtask id="4.3">Ejecutar mvn clean compile</subtask>
        </subtasks>
      </task>
      
      <task id="5" ac="AC4,AC8">
        <title>Implement ArchUnit Tests</title>
        <subtasks>
          <subtask id="5.1">Crear HexagonalArchitectureTest.java</subtask>
          <subtask id="5.2">Implementar test domainShouldNotDependOnFrameworks()</subtask>
          <subtask id="5.3">Implementar test applicationCannotDependOnInfrastructure()</subtask>
          <subtask id="5.4">Implementar test layersShouldBeRespected()</subtask>
          <subtask id="5.5">Ejecutar mvn test -Dtest=HexagonalArchitectureTest</subtask>
        </subtasks>
      </task>
      
      <task id="6" ac="AC8">
        <title>Create Spring Context Test</title>
        <subtasks>
          <subtask id="6.1">Crear SignatureRouterApplicationTests.java</subtask>
          <subtask id="6.2">Implementar test contextLoads()</subtask>
          <subtask id="6.3">Ejecutar mvn test</subtask>
        </subtasks>
      </task>
      
      <task id="7" ac="AC7">
        <title>Create README and Documentation</title>
        <subtasks>
          <subtask id="7.1">Crear README.md con secciones completas</subtask>
          <subtask id="7.2">Verificar links a docs/ existentes</subtask>
          <subtask id="7.3">Crear CHANGELOG.md con entrada inicial</subtask>
        </subtasks>
      </task>
      
      <task id="8" ac="AC8">
        <title>Final Build and Verification</title>
        <subtasks>
          <subtask id="8.1">Ejecutar mvn clean install</subtask>
          <subtask id="8.2">Verificar artifact generado en target/</subtask>
          <subtask id="8.3">Verificar JAR ejecutable con java -jar</subtask>
          <subtask id="8.4">Ejecutar mvn verify</subtask>
          <subtask id="8.5">Verificar código coverage (jacoco:report)</subtask>
          <subtask id="8.6">Commit inicial con tag v0.1.0-story-1.1</subtask>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC1">
      <title>Maven Project Structure Created</title>
      <given>Un repositorio Git inicializado</given>
      <when>Ejecuto el bootstrap del proyecto</when>
      <then>
        Se genera estructura Maven con:
        - Root pom.xml (groupId: com.bank.signature, artifactId: signature-router, version: 0.1.0-SNAPSHOT)
        - Spring Boot parent: 3.2.0
        - Java version: 21
        - Maven Wrapper incluido (.mvn/wrapper/)
        - .gitignore configurado (target/, .idea/, *.iml, .DS_Store, *.log)
      </then>
      <verification>
        mvn clean compile ejecuta exitosamente
      </verification>
    </criterion>

    <criterion id="AC2">
      <title>Hexagonal Package Structure</title>
      <given>El proyecto Maven creado</given>
      <when>Examino la estructura de paquetes Java</when>
      <then>
        Existen paquetes bajo src/main/java/com/bank/signature/:
        - domain/ (model/aggregate/, model/entity/, model/valueobject/, service/, port/inbound/, port/outbound/, exception/)
        - application/ (usecase/, dto/)
        - infrastructure/ (adapter/inbound/rest/, adapter/outbound/persistence/, adapter/outbound/provider/, adapter/outbound/event/, config/)
        - infrastructure/SignatureRouterApplication.java (main class)
      </then>
      <verification>
        Todos los directorios existen (pueden estar vacíos excepto infrastructure/)
      </verification>
    </criterion>

    <criterion id="AC3">
      <title>Spring Boot Application Starts</title>
      <given>La estructura de proyecto completa</given>
      <when>Ejecuto mvn spring-boot:run</when>
      <then>
        - La aplicación inicia exitosamente mostrando log: "Started SignatureRouterApplication in X seconds"
        - El servidor Tomcat inicia en puerto 8080 (configurable)
        - No hay errores de compilación ni runtime exceptions
      </then>
      <verification>
        Aplicación alcanza estado "Started" sin excepciones
      </verification>
    </criterion>

    <criterion id="AC4">
      <title>Domain Layer Zero Dependencies</title>
      <given>El paquete domain/ creado</given>
      <when>Ejecuto test de arquitectura ArchUnit</when>
      <then>
        El test HexagonalArchitectureTest.domainShouldNotDependOnFrameworks() pasa, verificando:
        - domain/ NO importa: org.springframework.*, javax.persistence.*/jakarta.persistence.*, com.fasterxml.jackson.*, org.apache.kafka.*
        - domain/ SOLO depende de: java.*, javax.* (core Java), otros paquetes domain/, Lombok (annotations)
        
        El test applicationCannotDependOnInfrastructure() pasa, verificando:
        - application/ NO importa infrastructure.adapter.*
        - application/ puede importar domain/ e infrastructure.config.*
      </then>
      <verification>
        ArchUnit tests pasan sin violaciones
      </verification>
    </criterion>

    <criterion id="AC5">
      <title>Essential Dependencies Configured</title>
      <given>El archivo pom.xml</given>
      <when>Reviso las dependencias declaradas</when>
      <then>
        Incluye:
        - spring-boot-starter-web
        - spring-boot-starter-data-jpa
        - spring-boot-starter-actuator
        - lombok (scope: provided)
        - spring-boot-starter-test (scope: test)
        - archunit-junit5 version 1.1.0 (scope: test)
        
        Dependencias adicionales se agregarán en stories subsecuentes (PostgreSQL, Kafka, Vault, OpenAPI)
      </then>
      <verification>
        mvn dependency:tree resuelve correctamente
      </verification>
    </criterion>

    <criterion id="AC6">
      <title>Application Configuration Files</title>
      <given>La estructura de resources</given>
      <when>Reviso src/main/resources/</when>
      <then>
        Existen archivos:
        - application.yml (configuración base: app name, profiles, server port, actuator endpoints, logging)
        - application-local.yml (development: JPA show-sql, DEBUG logging)
        - application-test.yml (testing: JPA validate, Flyway disabled)
      </then>
      <verification>
        Archivos YAML parsean correctamente
      </verification>
    </criterion>

    <criterion id="AC7">
      <title>README and Documentation</title>
      <given>El proyecto creado</given>
      <when>Abro el archivo README.md en root</when>
      <then>
        Contiene:
        - Project Name: Signature Router & Management System
        - Description: Banking-grade digital signature routing
        - Prerequisites: Java 21+, Maven 3.9+, Docker & Docker Compose
        - Quick Start: Build, Run, Test commands
        - Architecture: Link a docs/architecture/README.md
        - Tech Stack: Spring Boot 3.2, Java 21, PostgreSQL 15, Kafka 3.6
        - Project Structure: Descripción de capas hexagonales
      </then>
      <verification>
        README contiene todas las secciones requeridas
      </verification>
    </criterion>

    <criterion id="AC8">
      <title>Build and Tests Pass</title>
      <given>El proyecto completamente configurado</given>
      <when>Ejecuto mvn clean install</when>
      <then>
        El build completa exitosamente:
        - Compilación sin errores
        - Tests unitarios pasan (ArchUnit tests)
        - Artifact generado: target/signature-router-0.1.0-SNAPSHOT.jar
        
        Cuando ejecuto mvn test:
        - HexagonalArchitectureTest.domainShouldNotDependOnFrameworks() ✅
        - HexagonalArchitectureTest.applicationCannotDependOnInfrastructure() ✅
        - SignatureRouterApplicationTests.contextLoads() ✅
      </then>
      <verification>
        mvn clean install exit code 0, todos los tests verdes
      </verification>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture/02-hexagonal-structure.md</path>
        <title>Hexagonal Architecture - Package Structure</title>
        <section>Maven Project Structure</section>
        <snippet>
          Define la estructura completa de paquetes hexagonales:
          - domain/ (pure business logic, zero framework dependencies)
          - application/ (use case orchestration)
          - infrastructure/ (adapters: REST controllers, JPA repositories, providers, configs)
          Incluye package naming conventions y layer responsibilities.
        </snippet>
        <relevance>Especificación autoritativa de la estructura de paquetes a crear en AC2</relevance>
      </doc>

      <doc>
        <path>docs/architecture/01-system-overview.md</path>
        <title>System Overview - C4 Container Model</title>
        <section>Technology Stack</section>
        <snippet>
          Tech stack completo:
          - Backend: Spring Boot 3.2.0, Java 21
          - Build: Maven 3.9+
          - Database: PostgreSQL 15 (Story 1.2)
          - Messaging: Kafka 3.6 (Story 1.3)
          - Security: Spring Security OAuth2 (Story 1.7)
          - Testing: JUnit 5, Testcontainers, ArchUnit
        </snippet>
        <relevance>Define versiones exactas de tecnologías para AC1, AC5</relevance>
      </doc>

      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Infrastructure</title>
        <section>Services and Modules</section>
        <snippet>
          Detalla los 12 módulos/packages principales:
          - domain/model/aggregate, entity, valueobject (Story 1.5)
          - domain/service, port/inbound, port/outbound
          - application/usecase, dto (Epic 2+)
          - infrastructure/adapter/inbound/rest (Story 1.7)
          - infrastructure/adapter/outbound/persistence (Story 1.6)
          - infrastructure/config (Stories 1.2-1.4)
        </snippet>
        <relevance>Tech spec autoritativo para Story 1.1 - package organization</relevance>
      </doc>

      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Infrastructure</title>
        <section>Dependencies and Integrations - Maven Dependencies</section>
        <snippet>
          Lista completa de dependencies Maven requeridas:
          Core: spring-boot-starter-web, data-jpa, actuator, security, oauth2-resource-server
          Database: postgresql, flyway-core (Story 1.2)
          Messaging: spring-kafka, kafka-avro-serializer (Story 1.3)
          Vault: spring-cloud-starter-vault-config (Story 1.4)
          Utilities: lombok, uuid-creator
          Testing: spring-boot-starter-test, testcontainers (postgresql, kafka), archunit-junit5 1.1.0
        </snippet>
        <relevance>Especifica dependencies exactas para AC5 - incluir solo las esenciales en Story 1.1</relevance>
      </doc>

      <doc>
        <path>docs/prd.md</path>
        <title>Product Requirements Document</title>
        <section>NFR-A6: Hexagonal Architecture</section>
        <snippet>
          NFR-A6: Sistema debe implementar arquitectura hexagonal estricta con:
          - Domain layer 100% framework-agnostic (validado con ArchUnit)
          - Clear separation: domain ← application ← infrastructure
          - Dependency inversion via ports (interfaces)
          Validación: ArchUnit tests enforcement
        </snippet>
        <relevance>Requirement autoritativo para AC4 - ArchUnit tests obligatorios</relevance>
      </doc>

      <doc>
        <path>docs/epics.md</path>
        <title>Epics and User Stories</title>
        <section>Epic 1 - Story 1.1</section>
        <snippet>
          Story 1.1: Project Bootstrap & Hexagonal Structure
          Acceptance Criteria resumen:
          - Maven multi-module project (Spring Boot 3.2+, Java 21)
          - Paquetes hexagonales: domain/, application/, infrastructure/
          - Application.java con @SpringBootApplication
          - pom.xml con dependencias core
          - Estructura compila sin errores (mvn clean install)
          - Domain NO depende de Spring/JPA (ArchUnit test)
        </snippet>
        <relevance>AC originales del epic - base para Story draft</relevance>
      </doc>
    </docs>

    <code>
      <artifact>
        <path>PLACEHOLDER: src/main/java/com/bank/signature/infrastructure/SignatureRouterApplication.java</path>
        <kind>main-class</kind>
        <symbol>SignatureRouterApplication</symbol>
        <status>to-be-created</status>
        <reason>Entry point de la aplicación Spring Boot - Task 2.3-2.5</reason>
        <template>
          @SpringBootApplication
          @ComponentScan(basePackages = "com.bank.signature")
          public class SignatureRouterApplication {
              public static void main(String[] args) {
                  SpringApplication.run(SignatureRouterApplication.class, args);
              }
          }
        </template>
      </artifact>

      <artifact>
        <path>PLACEHOLDER: src/test/java/com/bank/signature/HexagonalArchitectureTest.java</path>
        <kind>architecture-test</kind>
        <symbol>HexagonalArchitectureTest</symbol>
        <status>to-be-created</status>
        <reason>ArchUnit tests para enforcing hexagonal purity - Task 5</reason>
        <template>
          @AnalyzeClasses(packages = "com.bank.signature")
          public class HexagonalArchitectureTest {
              
              @Test
              void domainShouldNotDependOnFrameworks() {
                  noClasses()
                      .that().resideInAPackage("..domain..")
                      .should().dependOnClassesThat().resideInAnyPackage(
                          "org.springframework..",
                          "jakarta.persistence..",
                          "com.fasterxml.jackson..",
                          "org.apache.kafka.."
                      )
                      .check(importedClasses);
              }
              
              @Test
              void applicationCannotDependOnInfrastructure() {
                  noClasses()
                      .that().resideInAPackage("..application..")
                      .should().dependOnClassesThat().resideInAPackage("..infrastructure.adapter..")
                      .check(importedClasses);
              }
              
              @Test
              void layersShouldBeRespected() {
                  layeredArchitecture()
                      .layer("Domain").definedBy("..domain..")
                      .layer("Application").definedBy("..application..")
                      .layer("Infrastructure").definedBy("..infrastructure..")
                      .whereLayer("Domain").mayNotAccessAnyLayer()
                      .whereLayer("Application").mayOnlyAccessLayers("Domain")
                      .whereLayer("Infrastructure").mayOnlyAccessLayers("Domain", "Application")
                      .check(importedClasses);
              }
          }
        </template>
      </artifact>

      <artifact>
        <path>PLACEHOLDER: pom.xml</path>
        <kind>build-file</kind>
        <symbol>pom.xml</symbol>
        <status>to-be-created</status>
        <reason>Maven project descriptor - Task 1</reason>
        <criticalContent>
          - groupId: com.bank.signature
          - artifactId: signature-router
          - version: 0.1.0-SNAPSHOT
          - parent: spring-boot-starter-parent 3.2.0
          - properties: java.version=21, encoding=UTF-8
          - dependencies: web, data-jpa, actuator, lombok, archunit (ver AC5)
        </criticalContent>
      </artifact>
    </code>

    <dependencies>
      <maven>
        <core>
          <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
            <scope>compile</scope>
            <reason>REST API foundation (Story 1.7 leverages this)</reason>
          </dependency>
          <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
            <scope>compile</scope>
            <reason>JPA foundation (Story 1.6 leverages this)</reason>
          </dependency>
          <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
            <scope>compile</scope>
            <reason>Health checks, metrics endpoints</reason>
          </dependency>
        </core>
        <utilities>
          <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <scope>provided</scope>
            <reason>Reduce boilerplate (@Value, @Builder, @Slf4j)</reason>
          </dependency>
        </utilities>
        <testing>
          <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
            <reason>JUnit 5, Mockito, AssertJ</reason>
          </dependency>
          <dependency>
            <groupId>com.tngtech.archunit</groupId>
            <artifactId>archunit-junit5</artifactId>
            <version>1.1.0</version>
            <scope>test</scope>
            <reason>Architecture constraint validation (AC4)</reason>
          </dependency>
        </testing>
      </maven>
      
      <futureStories>
        <note>
          Dependencias a agregar en stories subsecuentes:
          - Story 1.2: postgresql, flyway-core, hikaricp
          - Story 1.3: spring-kafka, kafka-avro-serializer, confluent schema-registry
          - Story 1.4: spring-cloud-starter-vault-config
          - Story 1.7: springdoc-openapi-starter-webmvc-ui, spring-boot-starter-security, spring-boot-starter-oauth2-resource-server
        </note>
      </futureStories>
    </dependencies>
  </artifacts>

  <constraints>
    <architectural>
      <constraint id="ARCH-1">
        <rule>Domain layer MUST NOT depend on any framework (Spring, JPA, Jackson, Kafka)</rule>
        <validation>ArchUnit test domainShouldNotDependOnFrameworks() enforces this</validation>
        <rationale>Pure business logic maintainability, testability, framework-independence</rationale>
        <source>docs/architecture/02-hexagonal-structure.md - Domain Layer Responsibilities</source>
      </constraint>

      <constraint id="ARCH-2">
        <rule>Application layer MUST NOT depend on infrastructure adapters (only domain and infrastructure config)</rule>
        <validation>ArchUnit test applicationCannotDependOnInfrastructure() enforces this</validation>
        <rationale>Prevent coupling between use cases and specific adapter implementations</rationale>
        <source>docs/architecture/02-hexagonal-structure.md - Application Layer Responsibilities</source>
      </constraint>

      <constraint id="ARCH-3">
        <rule>Dependency flow MUST be unidirectional: Infrastructure → Application → Domain</rule>
        <validation>ArchUnit test layersShouldBeRespected() enforces this</validation>
        <rationale>Hexagonal architecture core principle - domain is center, infrastructure is periphery</rationale>
        <source>docs/architecture/02-hexagonal-structure.md - Layer Dependencies</source>
      </constraint>

      <constraint id="ARCH-4">
        <rule>Package naming convention: com.bank.signature.{layer}.{component}</rule>
        <examples>
          - domain.model.aggregate.SignatureRequest
          - application.usecase.StartSignatureUseCaseImpl
          - infrastructure.adapter.inbound.rest.SignatureController
        </examples>
        <source>docs/architecture/02-hexagonal-structure.md - Package Structure</source>
      </constraint>
    </architectural>

    <technology>
      <constraint id="TECH-1">
        <rule>Java version MUST be 21 (LTS, required for records, pattern matching, sealed classes)</rule>
        <validation>maven.compiler.source=21, maven.compiler.target=21 in pom.xml</validation>
        <source>docs/sprint-artifacts/tech-spec-epic-1.md - Technology Stack</source>
      </constraint>

      <constraint id="TECH-2">
        <rule>Spring Boot version MUST be 3.2.0 or higher (Spring 6, Jakarta EE 10)</rule>
        <validation>parent: spring-boot-starter-parent 3.2.0</validation>
        <source>docs/architecture/01-system-overview.md - Technology Stack</source>
      </constraint>

      <constraint id="TECH-3">
        <rule>Maven Wrapper MUST be included (./mvnw) for build reproducibility</rule>
        <validation>Verify .mvn/wrapper/maven-wrapper.jar exists</validation>
        <source>docs/sprint-artifacts/1-1-project-bootstrap-hexagonal-structure.md - AC1</source>
      </constraint>

      <constraint id="TECH-4">
        <rule>Application configuration MUST use YAML format (application.yml) over properties</rule>
        <rationale>Better readability, hierarchical structure, multi-document support</rationale>
        <source>docs/sprint-artifacts/tech-spec-epic-1.md - Spring Boot Configuration</source>
      </constraint>
    </technology>

    <testing>
      <constraint id="TEST-1">
        <rule>ArchUnit tests MUST be implemented and MUST pass before story completion</rule>
        <minimumTests>
          - domainShouldNotDependOnFrameworks()
          - applicationCannotDependOnInfrastructure()
          - layersShouldBeRespected()
        </minimumTests>
        <validation>mvn test -Dtest=HexagonalArchitectureTest all green</validation>
        <source>docs/sprint-artifacts/1-1-project-bootstrap-hexagonal-structure.md - AC4, AC8</source>
      </constraint>

      <constraint id="TEST-2">
        <rule>Spring Boot context MUST load successfully (SignatureRouterApplicationTests.contextLoads())</rule>
        <validation>mvn test includes context load test, exits 0</validation>
        <source>docs/sprint-artifacts/1-1-project-bootstrap-hexagonal-structure.md - AC8</source>
      </constraint>

      <constraint id="TEST-3">
        <rule>Test naming convention: *Test.java (unit), *IT.java (integration), *ArchitectureTest.java (architecture)</rule>
        <source>docs/sprint-artifacts/tech-spec-epic-1.md - Testing Standards</source>
      </constraint>
    </testing>

    <security>
      <constraint id="SEC-1">
        <rule>NO hardcoded credentials in code or configuration files</rule>
        <validation>Grep codebase for "password", "secret", "apiKey" → zero matches in committed files</validation>
        <rationale>PCI-DSS compliance, security best practices</rationale>
        <note>Story 1.4 implements Vault for secret management</note>
        <source>docs/sprint-artifacts/tech-spec-epic-1.md - Security Considerations</source>
      </constraint>

      <constraint id="SEC-2">
        <rule>.gitignore MUST exclude target/, IDE files (.idea/, *.iml), logs (*.log)</rule>
        <validation>Verify .gitignore contains required patterns</validation>
        <source>docs/sprint-artifacts/1-1-project-bootstrap-hexagonal-structure.md - AC1</source>
      </constraint>
    </security>

    <compliance>
      <constraint id="COMP-1">
        <rule>Project structure must support auditability (separation of concerns, immutable audit logs future)</rule>
        <rationale>GDPR, SOC 2 compliance - clear responsibility boundaries</rationale>
        <source>docs/sprint-artifacts/1-1-project-bootstrap-hexagonal-structure.md - Context - Compliance Requirements</source>
      </constraint>
    </compliance>
  </constraints>

  <interfaces>
    <interface>
      <name>SignatureRouterApplication</name>
      <kind>spring-boot-main-class</kind>
      <signature>
        @SpringBootApplication
        @ComponentScan(basePackages = "com.bank.signature")
        public class SignatureRouterApplication {
            public static void main(String[] args)
        }
      </signature>
      <path>src/main/java/com/bank/signature/infrastructure/SignatureRouterApplication.java</path>
      <purpose>Application entry point - Task 2.3-2.5</purpose>
    </interface>

    <interface>
      <name>HexagonalArchitectureTest</name>
      <kind>archunit-test-class</kind>
      <signature>
        @AnalyzeClasses(packages = "com.bank.signature")
        public class HexagonalArchitectureTest {
            void domainShouldNotDependOnFrameworks()
            void applicationCannotDependOnInfrastructure()
            void layersShouldBeRespected()
        }
      </signature>
      <path>src/test/java/com/bank/signature/HexagonalArchitectureTest.java</path>
      <purpose>Architecture constraint validation - Task 5</purpose>
    </interface>

    <interface>
      <name>Actuator Health Endpoint</name>
      <kind>REST-endpoint</kind>
      <signature>GET /actuator/health</signature>
      <response>
        HTTP 200 OK
        {
          "status": "UP",
          "components": {
            "diskSpace": {"status": "UP"},
            "ping": {"status": "UP"}
          }
        }
      </response>
      <path>Auto-configured by spring-boot-starter-actuator</path>
      <purpose>Health check verification - AC3, Task 3.7</purpose>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Testing framework: JUnit 5 (Jupiter) via spring-boot-starter-test.
      Architecture testing: ArchUnit 1.1.0 para validar constraints hexagonales.
      Naming conventions: *Test.java (unit tests), *IT.java (integration tests), *ArchitectureTest.java (architecture tests).
      Coverage target (Story 1.1): No aplicable (no domain logic yet), pero ArchUnit tests obligatorios.
      Test location: src/test/java/ mirroring src/main/java/ package structure.
      Assertions: AssertJ preferred (included in spring-boot-starter-test).
    </standards>

    <locations>
      <location>src/test/java/com/bank/signature/HexagonalArchitectureTest.java</location>
      <location>src/test/java/com/bank/signature/infrastructure/SignatureRouterApplicationTests.java</location>
      <pattern>src/test/java/**/*Test.java</pattern>
      <pattern>src/test/java/**/*IT.java</pattern>
    </locations>

    <ideas>
      <testIdea ac="AC1">
        <name>Maven Build Success Test</name>
        <description>Automated test ejecutando mvn clean install y verificando exit code 0</description>
        <approach>Script bash/shell o Maven Invoker plugin test</approach>
        <priority>high</priority>
      </testIdea>

      <testIdea ac="AC2">
        <name>Package Structure Verification Test</name>
        <description>Unit test que verifica existencia de directorios clave usando Files.exists()</description>
        <approach>
          @Test
          void hexagonalPackagesExist() {
              assertTrue(Files.exists(Path.of("src/main/java/com/bank/signature/domain")));
              assertTrue(Files.exists(Path.of("src/main/java/com/bank/signature/application")));
              assertTrue(Files.exists(Path.of("src/main/java/com/bank/signature/infrastructure")));
          }
        </approach>
        <priority>medium</priority>
      </testIdea>

      <testIdea ac="AC3">
        <name>Application Startup Test</name>
        <description>SignatureRouterApplicationTests.contextLoads() - verifica que Spring context carga sin errores</description>
        <approach>@SpringBootTest annotation, test method vacío (si pasa, context loaded)</approach>
        <priority>high</priority>
        <status>Required by AC8</status>
      </testIdea>

      <testIdea ac="AC4">
        <name>Domain Purity ArchUnit Tests</name>
        <description>3 tests de ArchUnit: domainShouldNotDependOnFrameworks, applicationCannotDependOnInfrastructure, layersShouldBeRespected</description>
        <approach>ArchUnit @AnalyzeClasses, noClasses().that()...should()... assertions</approach>
        <priority>critical</priority>
        <status>Required by AC4 and AC8</status>
      </testIdea>

      <testIdea ac="AC5">
        <name>Dependency Resolution Test</name>
        <description>Verificar que mvn dependency:tree resuelve sin conflictos</description>
        <approach>Maven Enforcer Plugin con dependencyConvergence rule</approach>
        <priority>low</priority>
      </testIdea>

      <testIdea ac="AC6">
        <name>Configuration Files Validation Test</name>
        <description>Unit test que verifica que application.yml, application-local.yml, application-test.yml parsean correctamente</description>
        <approach>YamlPropertiesFactoryBean o @ConfigurationProperties binding test</approach>
        <priority>medium</priority>
      </testIdea>

      <testIdea ac="AC7">
        <name>README Content Verification</name>
        <description>Test que verifica que README.md contiene secciones obligatorias (Prerequisites, Quick Start, etc.)</description>
        <approach>Parse README.md, assert contains("## Prerequisites"), contains("## Quick Start")</approach>
        <priority>low</priority>
      </testIdea>

      <testIdea ac="AC8">
        <name>Full Build Integration Test</name>
        <description>CI pipeline test que ejecuta mvn clean install y verifica artifact generado</description>
        <approach>GitHub Actions workflow o script shell, assert target/signature-router-0.1.0-SNAPSHOT.jar exists</approach>
        <priority>high</priority>
        <status>Part of DoD - final verification</status>
      </testIdea>
    </ideas>
  </tests>

  <definitionOfDone>
    <criterion>Code Complete: Todos los tasks (1-8) marcados como completados</criterion>
    <criterion>Build Success: mvn clean install ejecuta sin errores (exit code 0)</criterion>
    <criterion>Tests Pass: Todos los tests (ArchUnit + context load) pasan</criterion>
    <criterion>Architecture Validated: ArchUnit tests confirman hexagonal purity (AC4)</criterion>
    <criterion>Application Runs: mvn spring-boot:run inicia aplicación exitosamente (AC3)</criterion>
    <criterion>Health Check: GET /actuator/health retorna HTTP 200 {"status":"UP"}</criterion>
    <criterion>Documentation: README.md completo con quick start instructions (AC7)</criterion>
    <criterion>Code Review: SM/Architect revisa estructura de packages y configuración</criterion>
    <criterion>Git Committed: Código committed a repositorio con tag v0.1.0-story-1.1</criterion>
    <criterion>No Linter Errors: Código pasa linters (Checkstyle/PMD si configurados)</criterion>
    <criterion>Dependencies Declared: Todas las dependencies necesarias en pom.xml (AC5)</criterion>
    <criterion>Profiles Working: Perfiles local y test funcionan correctamente (AC6)</criterion>
  </definitionOfDone>

  <blockers>
    <blocker>
      <description>Ninguno - Esta es la primera story del proyecto</description>
      <status>N/A</status>
    </blocker>
  </blockers>

  <nextStories>
    <story id="1.2">
      <title>PostgreSQL Database Setup & Flyway Migrations</title>
      <dependency>Requiere estructura base de Story 1.1 (pom.xml, package structure, Spring Boot app)</dependency>
    </story>
    <story id="1.3">
      <title>Kafka Infrastructure & Schema Registry</title>
      <dependency>Requiere estructura base de Story 1.1</dependency>
    </story>
    <story id="1.4">
      <title>HashiCorp Vault Integration</title>
      <dependency>Requiere estructura base de Story 1.1</dependency>
    </story>
    <story id="1.5">
      <title>Domain Models, Aggregates & Entities</title>
      <dependency>Requiere domain/ package structure de Story 1.1</dependency>
    </story>
  </nextStories>

  <implementationNotes>
    <note priority="high">
      Story 1.1 es FOUNDATIONAL - todas las Stories 1.2-1.8 dependen de esta base.
      No se puede proceder a ninguna otra story hasta que Story 1.1 esté DONE.
    </note>
    <note priority="high">
      ArchUnit tests son OBLIGATORIOS - no aceptar PR sin estos tests pasando.
      Estos tests son el enforcement mechanism para hexagonal purity.
    </note>
    <note priority="medium">
      Usar Maven Wrapper (./mvnw) en lugar de mvn global para reproducibilidad del build.
      Esto garantiza que todos los devs usan la misma versión de Maven.
    </note>
    <note priority="medium">
      Crear directorios vacíos con .gitkeep para que Git los trackee.
      Git no trackea directorios vacíos por default.
    </note>
    <note priority="low">
      Considerar agregar Maven Enforcer Plugin para enforcing dependency convergence y Java version.
      Esto previene conflictos de versiones y uso de Java incorrecto.
    </note>
    <note priority="low">
      application-local.yml tiene JPA show-sql=true para debugging en dev.
      En producción esto debe estar disabled (performance impact).
    </note>
  </implementationNotes>
</story-context>
